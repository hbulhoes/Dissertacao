 %!TEX root = Projeto.tex
\section{Motivação}

% Contextualizar: o que está exposto no browser que deva ser protegido? Quais riscos?
A diversidade das aplicações disponíveis na web reflete a demanda de seus usuários por funcionalidade útil e interessante. A popularidade dessa plataforma denota o grau de confiança depositada pelos usuários em sua infraestrutura, ou não haveria procura pela utilização de serviços como comércio eletrônico, transações bancárias, redes sociais e troca de mensagens, para mencionar algumas das categorias de aplicações que fazem uso intensivo de dados pessoais, incluindo dados sigilosos ou de uso restrito.

A confiança com que os usuários interagem com a web, no entanto, é constantemente desafiada por falhas sistêmicas e ataques deliberados que culminam com o roubo e a adulteração das informações roteadas pelos diversos componentes que dão suporte às funcionalidades das aplicações web. Muitas vezes, o risco de vazamento de informação se manifesta justamente na ponta mais próxima do usuário: seu software navegador de internet. Ataques como o redirecionamento de \textit{scripts} em sites do \textit{bureau} de crédito norte-americano Equifax \cite{Segura2017}, a invasão e adulteração de scripts da rede de distribuição de conteúdo BootstrapCDN \cite{Dorfman2013}, a ousada exploração de \textit{malware} atingindo usuários do site E-Bay \cite{Vanunu2016}, e as divulgações recentes do comprometimento de extensões do aplicativo Chrome \cite{Forrest2017} apontam para vulnerabilidades intrínsecas nos recursos do navegador que dão suporte ao ``conteúdo ativo'', mecanismo essencial para as aplicações web interativas modernas \cite{Hedin2016}.

% Contextualizar: por que é importante um esforço para ajudar o desenvolvedor na proteção do conteúdo no navegador?
Assim, o desenvolvimento de uma aplicação segura para a web demanda esforços para que seja evitada a exposição e a manipulação indevidas das informações do usuário. Para esse propósito, o desenvolvedor conta com um conjunto de práticas e recomendações estabelecidas, efetivamente protegendo a aplicação e seus usuários de uma série de vulnerabilidades. Conjuntos de regras, como a SOP (\textit{same-origin policy}), e protocolos como o CORS (\textit{cross-origin resource sharing}) elevam a capacidade do navegador em manter um ambiente de execução seguro. Ambos se baseiam na noção do ``domínio'' como identificador da origem e, por consequência, da confiabilidade de um recurso: o domínio da página, denotado pela combinação do \textit{protocolo}, \textit{nome do host} e \textit{porta TCP} de onde o navegador requisitou o conteúdo carregado, é tido como o mais confiável, enquanto recursos requisitados de domínios diferentes são considerados menos confiáveis.
%CORS, por exemplo, foi destacado por \cite{DeRyck2012} em sua avaliação de mecanismos de segurança no navegador, na qual diversos dos mecanismos disponíveis são comparados segundo quatro categorias de requisitos -- Separação, Interação, Comunicação e Controle do Comportamento.

Contudo, tal ambiente é protegido dentro da condição de que todo conteúdo ativo carregado por uma aplicação está sob o conhecimento e confiança de seu desenvolvedor, o que nem sempre é o caso \cite{Heule2015_Most_Dangerous_Code}. Dentro da estrutura de documento da página web as informações dos usuários permanecem fundamentalmente expostas a \textit{scripts} mal-intencionados ou mal-escritos, executados em contexto da página ou como extensões do navegador. Criar um \textit{script} destinado a ler o conteúdo potencialmente sigiloso de uma página da web e revelá-lo a terceiros não autorizados é uma tarefa que exige pouca habilidade e que pode passar despercebida pelo aparato de segurança disponível, incluindo as restrições de SOP e CORS.

Código \textit{inline} ou \textit{scripts} baixados pelas páginas da web são executados com os mesmos privilégios e mesmo nível de acesso à estrutura de documento do navegador, o chamado DOM (\textit{document object model}) \cite[p. 2-3]{DeRyck2012}, não importando o domínio de origem dos scripts. Uma demonstração do problema pode ser exemplificada na figura \ref{Fig: diagrama01} e listagem de código \ref{Src: webPageMultiOrigin}. Nesse exemplo, um script tido como benigno é incorporado a uma página web a partir de um domínio de CDN (\textit{content delivery network}), diferente daquele da aplicação que efetivamente publica a página. O servidor da página, pelo protocolo CORS, sinaliza ao navegador que o domínio da CDN é confiável. O script externo pode, então, iniciar requisições ao seu domínio de origem -- uma consequência desejada pelos autores da página, pois o script depende desse acesso para efetuar suas funções.

\begin{figure}
	\centering
	\includegraphics[width=15cm]{diagramas/diagrama01.pdf}
	\caption{Aplicação web composta por conteúdo proveniente de duas origens.}
	\label{Fig: diagrama01}
	
	\lstinputlisting[language=html,
		inputencoding=utf8,
		label={Src: webPageMultiOrigin},
		caption={[Página HTML incorporando script de outra origem]Incorporação de script de outra origem (linha \ref{lstCdnScript})}]{codigo/sample01-leaking-script.html}
\end{figure}

Em momento posterior, o script servido pelos servidores da CDN é substituído por código malicioso que, além de efetuar as funções do script benigno, captura o conteúdo da página armazenado no DOM \ref{Fig: diagrama02}. O script pode buscar informações específicas e potencialmente sensíveis como identificação do usuário, senhas e endereços. Por causa da autorização concedida pelo protocolo CORS, o código mal intencionado tem a chance de transmitir o conteúdo capturado para um serviço anômalo.

\begin{figure}
	\centering
	\includegraphics[width=15cm]{diagramas/diagrama02.pdf}
	\caption{Domínio de CDN comprometido, capturando informações do usuário.}
	\label{Fig: diagrama02}
\end{figure}

Acessar, capturar e modificar informações contidas no DOM também são efeitos de extensões do navegador. Mas, diferentemente dos scripts incorporados em páginas, extensões são executadas em modo privilegiado e podem afetar todas as páginas carregadas pelo navegador, não sendo confinadas a domínios específicos. Extensões como as do Google Chrome são publicadas exclusivamente em site específico e protegido, mas não é impossível que o código fonte de extensões seja descaracterizado e publicado pela ação de \textit{hackers} \cite{Spring2017}, afetando a todos os usuários que atualizarem a extensão -- um processo automático por padrão \cite{Google2017}. 

% Contextualizar: o que tem sido feito nessa direção, em termos de experimentos?
Na raiz das vulnerabilidades está a forma inconsistente e parcial com que a linguagem Javascript e as APIs do navegador tratam o relacionamento entre os \textit{scripts}, o acesso à rede, e à estrutura do DOM. Uma das formas propostas para a solução dessas inconsistências seria a introdução de uma política de segurança que monitorasse o fluxo da informação na linguagem Javascript \cite[p.3]{Heule2015_IFC_Inside}. Dessa forma, toda cópia, referência ou manipulação de dados na linguagem dependeria de uma validação dos contextos de segurança atribuídos ao dado e aos recipientes envolvidos. Isso impediria, por exemplo, que informações sensíveis presentes em um nó do DOM fossem lidas e transmitidas para endereços da web desautorizados -- um impedimento que não seria obedecido de forma discricionária, imperativa, mas de modo mandatório, declarativo e integrado ao \textit{runtime} da linguagem. Essa abordagem, conhecida pela sigla IFC (\textit{information flow control}), não é compatível com os navegadores existentes. Mecanismos de suporte ao IFC são implementados como navegadores experimentais \cite{Hedin2014, Bichhawat2014}, o que impede sua adoção maciça.

% Contextualizar: como esta proposta contribui?
Assim, se os meios existentes para proteção contra o vazamento de informação contida no DOM são insuficientes, e se um mecanismo robusto como o IFC ainda não foi incorporado aos navegadores tradicionais, pode ser importante propor uma abordagem que desse ao desenvolvedor um mecanismo que, embora discricionário, implementasse uma barreira que impedisse o acesso não prescrito aos nós, ou regiões, do DOM, a critério do desenvolvedor. Isso tornou-se uma possibilidade com a introdução de APIs como a de suporte ao \textit{Shadow DOM} \cite{W3C:ShadowDOM}, que fornecem um grau de invisibilidade a determinados conteúdos de HTML. Propor uma melhoria da segurança da informação baseada em APIs padronizadas, imediatamente disponíveis aos desenvolvedores e usuários, é a proposta deste trabalho.